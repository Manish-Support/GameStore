<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SpinStreak</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-y: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      box-sizing: border-box;
      padding: 10px 20px;
    }

    #main-container {
      width: 100%;
      max-width: 600px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 24px;
      padding: 30px 35px 25px 35px;
      box-shadow:
        0 15px 40px rgba(0, 0, 0, 0.3),
        inset 0 0 15px rgba(255, 255, 255, 0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
      position: relative;
      perspective: 900px;
    }

    .main-header {
      background: #ffffff;
      color: #222;
      font-size: 1.8rem;
      font-weight: 900;
      padding: 12px 25px;
      border-radius: 14px;
      box-shadow:
        0 4px 8px rgba(0, 0, 0, 0.15),
        0 8px 20px rgba(0, 0, 0, 0.1);
      text-align: center;
      transform-style: preserve-3d;
      transform: rotateX(5deg);
      transition: transform 0.3s ease;
      width: 100%;
      margin-bottom: 25px;
      user-select: none;
    }
    .main-header:hover {
      transform: rotateX(0deg);
      box-shadow:
        0 6px 14px rgba(0, 0, 0, 0.25),
        0 12px 30px rgba(0, 0, 0, 0.15);
    }

    #wheel-container {
      position: relative;
      width: 360px;
      height: 360px;
      margin-bottom: 20px;
      background: linear-gradient(145deg, #f0f4ff, #d1d9ff);
      border-radius: 50%;
      box-shadow:
        inset 0 6px 12px rgba(255, 255, 255, 0.9),
        0 12px 30px rgba(0, 0, 0, 0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      transition: box-shadow 0.3s ease;
      transform-style: preserve-3d;
      overflow: hidden; /* clip confetti */
    }
    #wheel-container:hover {
      box-shadow:
        inset 0 8px 16px rgba(255, 255, 255, 1),
        0 18px 40px rgba(0, 0, 0, 0.35);
    }

    canvas#wheel {
      border-radius: 50%;
      display: block;
      margin: 0;
      background: transparent;
      user-select: none;
      width: 100%;
      height: 100%;
      border: none;
      box-shadow:
        inset 0 0 15px rgba(0, 0, 0, 0.1),
        0 0 12px rgba(0, 0, 0, 0.05);
      transform-style: preserve-3d;
      transition: box-shadow 0.3s ease;
    }
    #wheel-container:hover canvas#wheel {
      box-shadow:
        inset 0 0 25px rgba(0, 0, 0, 0.15),
        0 0 20px rgba(0, 0, 0, 0.1);
    }

    #spin-indicator {
      position: absolute;
      left: 50%;
      bottom: -16px;
      transform: translateX(-50%);
      width: 40px;
      height: 40px;
      background: #222;
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
      border-radius: 8px;
      box-shadow:
        0 0 15px rgba(0, 0, 0, 0.9),
        0 0 25px #4e54c8;
      pointer-events: none;
      z-index: 10;
      filter: drop-shadow(0 0 3px #4e54c8);
      transition: box-shadow 0.3s ease;
    }
    #spin-indicator:hover {
      box-shadow:
        0 0 20px rgba(0, 0, 0, 1),
        0 0 35px #6a6efb;
    }

    #spinBtn {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(145deg, #ffffff, #d1d9ff);
      color: #222;
      border: none;
      width: 90px;
      height: 90px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow:
        0 6px 10px rgba(0, 0, 0, 0.15),
        inset 0 4px 8px #f9faff,
        inset 0 -4px 6px #b0b8ff;
      font-size: 20px;
      font-weight: 800;
      user-select: none;
      transition: background 0.3s, box-shadow 0.3s, transform 0.2s;
      z-index: 20;
      transform-style: preserve-3d;
    }
    #spinBtn:hover:not(:disabled) {
      background: linear-gradient(145deg, #e0e6ff, #aab6ff);
      box-shadow:
        0 8px 14px rgba(0, 0, 0, 0.25),
        inset 0 6px 10px #e6ebff,
        inset 0 -6px 8px #8a9eff;
      transform: translate(-50%, -50%) scale(1.05);
    }
    #spinBtn:active:not(:disabled) {
      transform: translate(-50%, -50%) scale(0.95);
      box-shadow:
        0 4px 8px rgba(0, 0, 0, 0.2),
        inset 0 2px 4px #c0c8ff,
        inset 0 -2px 3px #7a8eff;
    }
    #spinBtn:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
      color: #666;
      transform: translate(-50%, -50%) scale(1);
    }

    .points-display {
      font-size: 22px;
      font-weight: 800;
      color: #4a3db7;
      margin: 10px 0 6px 0;
      text-shadow: 0 0 8px rgba(74, 61, 183, 0.9);
      user-select: none;
      letter-spacing: 0.03em;
      transition: transform 0.3s ease, color 0.3s ease, text-shadow 0.3s ease;
    }

    .message {
      font-size: 18px;
      margin: 6px 0 0 0;
      color: #333;
      user-select: none;
      font-weight: 600;
      min-height: 28px;
      text-align: center;
      letter-spacing: 0.02em;
      transition: color 0.3s ease;
    }

    /* Confetti styles */
    .confetti {
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: red;
      opacity: 0.9;
      pointer-events: none;
      will-change: transform, opacity;
      border-radius: 2px;
      animation-timing-function: ease-out;
    }
  </style>
</head>
<body>
  <div id="main-container">
    <h1 class="main-header">SpinStreak - Endless spinning</h1>

    <div id="wheel-container">
      <canvas id="wheel" width="400" height="400"></canvas>
      <div id="spin-indicator"></div>
      <button id="spinBtn" aria-label="Spin the wheel">Spin</button>
    </div>

    <div class="points-display">Total Points: <span id="totalPoints">0</span></div>
    <div class="message" id="message"></div>
  </div>

  <script>
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');
    const totalPointsEl = document.getElementById('totalPoints');
    const messageEl = document.getElementById('message');
    const wheelContainer = document.getElementById('wheel-container');
    let totalPoints = parseInt(localStorage.getItem('spinPoints') || 0);
    totalPointsEl.textContent = totalPoints;

    const segments = [
      [72, '#1abc9c', 10, '10 Pts'],
      [72, '#e91e63', 50, '50 Pts'],
      [72, '#f1c40f', 100, '100 Pts'],
      [72, '#8e44ad', 500, '500 Pts'],
      [72, '#34495e', 0, 'Reset 0 Pts']
    ];

    let angle = 0;
    let isSpinning = false;
    const center = canvas.width / 2;

    function drawWheel() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Outer ring
      const ringOuterRadius = center - 2;
      const ringInnerRadius = center - 30;
      const ringGradient = ctx.createRadialGradient(center, center, ringInnerRadius, center, center, ringOuterRadius);
      ringGradient.addColorStop(0, '#2ecc71');
      ringGradient.addColorStop(0.5, '#27ae60');
      ringGradient.addColorStop(1, '#145a32');
      ctx.fillStyle = ringGradient;
      ctx.beginPath();
      ctx.arc(center, center, ringOuterRadius, 0, 2 * Math.PI);
      ctx.arc(center, center, ringInnerRadius, 0, 2 * Math.PI, true);
      ctx.closePath();
      ctx.fill();

      let startAngle = 0;
      for (let i = 0; i < segments.length; i++) {
        const [arc, color, points, label] = segments[i];

        const midAngle = startAngle + (arc * Math.PI / 360);
        const segmentRadius = center - 40;

        // Gradient for segment
        const grad = ctx.createRadialGradient(
          center,
          center,
          segmentRadius / 5,
          center,
          center,
          segmentRadius
        );
        grad.addColorStop(0, '#ffffffcc');
        grad.addColorStop(1, color);
        ctx.fillStyle = grad;
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 3;

        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, segmentRadius, startAngle, startAngle + (arc * Math.PI / 180));
        ctx.closePath();
        ctx.fill();
        ctx.stroke();

        // Text label
        const textRadius = center * 0.55;
        ctx.save();
        ctx.translate(center + Math.cos(midAngle) * textRadius, center + Math.sin(midAngle) * textRadius);
        ctx.rotate(midAngle + Math.PI / 2);
        ctx.fillStyle = '#222';
        ctx.font = 'bold 18px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.shadowColor = 'rgba(0,0,0,0.3)';
        ctx.shadowBlur = 3;
        ctx.fillText(label, 0, 0);
        ctx.restore();

        startAngle += arc * Math.PI / 180;
      }
    }

    // Confetti animation
    function createConfetti() {
      console.log('Confetti triggered for totalPoints:', totalPoints);
      const colors = ['#e91e63', '#f1c40f', '#1abc9c', '#8e44ad', '#34495e'];
      const confettiCount = 50;
      const confettis = [];

      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * wheelContainer.clientWidth + 'px';
        confetti.style.top = '-10px';
        confetti.style.width = (4 + Math.random() * 6) + 'px';
        confetti.style.height = (4 + Math.random() * 6) + 'px';
        confetti.style.opacity = Math.random() * 0.9 + 0.1;
        wheelContainer.appendChild(confetti);
        confettis.push({
          el: confetti,
          y: -10,
          speedY: 2 + Math.random() * 3,
          rotation: Math.random() * 360,
          rotationSpeed: (Math.random() - 0.5) * 20
        });
      }

      let animationFrameId;
      function animate() {
        for (let i = confettis.length - 1; i >= 0; i--) {
          const c = confettis[i];
          c.y += c.speedY;
          c.rotation += c.rotationSpeed;
          c.el.style.transform = `translateY(${c.y}px) rotate(${c.rotation}deg)`;
          if (c.y > wheelContainer.clientHeight) {
            wheelContainer.removeChild(c.el);
            confettis.splice(i, 1);
          }
        }
        if (confettis.length > 0) {
          animationFrameId = requestAnimationFrame(animate);
        } else {
          animationFrameId = null;
        }
      }
      animate();
    }

    function spinWheel() {
      if (isSpinning) return;
      isSpinning = true;
      spinBtn.disabled = true;
      messageEl.textContent = 'Spinning...';

      let spinAngle = Math.random() * 2 * Math.PI + 2 * Math.PI * (3 + Math.floor(Math.random() * 3));
      let duration = 3500;
      let startTime = Date.now();
      let startAngle = angle;

      function animate() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const ease = 1 - Math.pow(1 - progress, 3);
        angle = startAngle + spinAngle * ease;
        canvas.style.transform = `rotate(${angle * 180 / Math.PI}deg)`;
        drawWheel();
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          isSpinning = false;
          spinBtn.disabled = false;
          const normalizedAngle = (angle % (2 * Math.PI));
          let cumulativeAngle = 0;
          const pointerAngle = (2 * Math.PI - normalizedAngle + Math.PI / 2) % (2 * Math.PI);

          // Store previous total points before adding new points
          const prevTotalPoints = totalPoints;

          for (let i = 0; i < segments.length; i++) {
            cumulativeAngle += segments[i][0] * Math.PI / 180;
            if (pointerAngle < cumulativeAngle) {
              const pointsWon = segments[i][2];
              if (segments[i][3].toLowerCase().includes('reset')) {
                totalPoints = 0;
                messageEl.textContent = `Reset! Total points cleared.`;
              } else {
                totalPoints += pointsWon;
                messageEl.textContent = `You won ${pointsWon} points!`;

                // Check if totalPoints crossed any 1000 boundary
                const prevThousands = Math.floor(prevTotalPoints / 1000);
                const currThousands = Math.floor(totalPoints / 1000);
                if (currThousands > prevThousands && totalPoints > 0) {
                  console.log('Total points crossed a thousand boundary:', totalPoints);
                  createConfetti();
                }
              }
              localStorage.setItem('spinPoints', totalPoints);
              totalPointsEl.textContent = totalPoints;
              break;
            }
          }
        }
      }
      animate();
    }

    drawWheel();
    spinBtn.addEventListener('click', spinWheel);
  </script>
</body>
</html>
